#! /usr/bin/env ruby
# author: takano32 <takano32 at gmail.com>
#

require 'socket'

data = DATA.read
lines = []
data.each_line do |line|
  lines << line
end

rtkrcv_server = TCPServer.open(52001)
addr = rtkrcv_server.addr
addr.shift
puts 'server is on %s' % [addr.join(':')]

loop do
  Thread.start(rtkrcv_server.accept) do |s|
    puts '%s is accepted' % [s] if $DEBUG
    loop do
      s.write(lines.shuffle.first)
      sleep 1
    end
    puts '%s is gone' % [s] if $DEBUG
    s.close
  end
end


__END__
1841 323031   35.747316405  139.832212583    22.9303   2   5   6.0297   0.8646   4.8749   2.0896   1.8739   5.3484   1.00    1.7
1841 323033   35.747361671  139.832217791    25.9297   2   5   5.0170   0.7294   4.0673   1.7403   1.5625   4.4512  -0.00    1.5
1841 323034   35.747405331  139.832221206    28.3792   2   5   4.3626   0.6407   3.5439   1.5142   1.3606   3.8713  -0.00    1.8
1841 323035   35.747437805  139.832224283    30.1973   2   5   3.8827   0.5756   3.1602   1.3484   1.2126   3.4461  -0.00    1.0
1841 323036   35.747471139  139.832227157    32.3682   2   5   3.5056   0.5246   2.8590   1.2182   1.0964   3.1120  -0.00    1.5
1841 323037   35.747482295  139.832228145    33.1836   2   5   3.1961   0.4831   2.6121   1.1113   1.0011   2.8378  -0.00    1.0
1841 323038   35.747502077  139.832230067    34.5228   2   5   2.9344   0.4483   2.4038   1.0209   0.9206   2.6060  -0.00    1.5
1841 323039   35.747514290  139.832231422    35.4462   2   5   2.7085   0.4184   2.2243   0.9429   0.8511   2.4059  -0.00    1.1
1841 323040   35.747537433  139.832233193    37.0410   2   5   2.5105   0.3925   2.0674   0.8746   0.7904   2.2307  -0.00    1.2
1841 323041   35.747557169  139.832234895    38.3129   2   5   2.3352   0.3697   1.9286   0.8141   0.7366   2.0755  -0.00    1.4
1841 323042   35.747573816  139.832235672    39.3166   2   5   2.1787   0.3496   1.8049   0.7601   0.6887   1.9369  -0.00    1.4
1841 323043   35.747589587  139.832237008    40.3458   2   5   2.0380   0.3315   1.6939   0.7115   0.6456   1.8123  -0.00    1.0
1841 323044   35.747600102  139.832237532    40.9331   2   5   1.9149   0.3157   1.5968   0.6691   0.6080   1.7034   1.00    1.1
1841 323045   35.747603189  139.832237383    41.2464   2   5   1.7980   0.3009   1.5050   0.6288   0.5723   1.6000  -0.00    1.6
1841 323046   35.747603062  139.832237616    41.3702   2   5   1.6923   0.2876   1.4221   0.5924   0.5400   1.5064  -0.00    1.6
